# 시스템의 구성
<br/>

이 절에서는 컴퓨터의 주요 구성요소들인 CPU와 기억장치 및 I/O 장치들이 어떻게 서로 접속되고 상호 작용하는지 분석함으로써, 컴퓨터시스템을 구성하는 방법과 동작 원리에 대하여
살펴보고자 한다.
<br/>
<br/>
## 1. CPU와 기억장치의 접속

#### [CPU와 시스템 버스]
<img src="" width="100" height="100"/><br/>

위 그림은 CPU와 시스템 내의 다른 요소들 사이에 정보를 교환하는 통로가 되는 **시스템 버스**(system bus)를 보여주고 있다.
시스템 버스는 아래와 같은 세 가지 하부 버스(sub-bus)들로 이루어진다.
> 시스템 버스 (system bus)
> : CPU와 다른 요소들 간의 정보교환 통로

**주소 버스**(address bus)는 CPU가 외부로 발생하는 주소 정보를 전송하는 신호 선들의 집합이다.
각 주소 선은 하나의 주소 비트를 전송하는 데 사용되며, 전체 주소 선들의 개수가 CPU와 접속될 수 있는 최대 기억장치 용량을 결정해준다.
CPU가 발생하는 주소 비트들의 수를 주소 버스의 폭(width)이라고 하는데, 만약 그 폭이 16비트라면, 최대 2^16=65,536개(즉, 64K개) 기억 장소들의 주소를 지정해줄 수 있다.
> 주소 버스 (address bus)
> : 주소 정보를 전송하기 위한 신호선들의 집합

**데이터 버스**(data bus)는 CPU가 기억장치 혹은 I/O 장치와의 사이에 데이터를 전송하기 위한 신호 선들의 집합이다.
데이터 버스의 폭은 한 번에 전송될 수 있는 데이터 비트의 수를 결정해준다. 예를 들어, 데이터 버스가 32비트인 시스템에서는 CPU가 기억장치로부터 한 번에 32비트씩 읽어올 수 있다.
> 데이터 버스 (data bus)
> : 데이터를 전송하기 위한 신호선들의 집합

**제어 버스**(control bus)는 CPU가 시스템 내의 각종 요소들의 동작을 제어하는 데 필요한 신소 선들의 집합이다.
제어 신호 선들의 수는 CPU에 따라, 혹은 시스템 구성에 따라 달라진다.
그들 중에서 가장 기본적인 제어 신호들로는 기억장치 읽기/쓰기(memory read/write) 신호와 I/O 읽기/쓰기(I/O read/write) 신호가 있다.
> 제어 버스 (control bus)
> : 시스템 요소들의 동작을 제어하기 위한 신호선들의 집합

주소는 CPU에 의해 발생되어 기억장치와 I/O 장치로 보내지는 정보이기 때문에, 주소 버스는 단방향성(uni-directional)이다.
반면에 데이터 버스는 읽기와 쓰기 동작을 모두 지원해야 하므로 양방향 전송(bi-directional transfer)이 가능해야 한다.

CPU가 데이터를 기억장치의 특정 장소에 저장하거나 이미 저장되어 있는 내용을 읽는 동작을 **액세스**(access)한다고 말한다.
> 액세스 (access)
> : 기억장치에 데이터를 쓰거나, 저장된 내용을 읽는 동작

기억장치들은 액세스되는 방식에 따라 여러 가지로 분류될 수 있는데, 여기서는 반도체 기억장치들 중의 하나인 RAM(Random Access Memory)을 예로서 사용하기로 한다.
아래 그림은 CPU가 주소 버스, 데이터 버스 및 제어 신호 선들을 통하여 기억장치와 접속된 모습을 보여주고 있다.

#### [CPU와 기억장치의 접속]
<img src="" width="100" height="100"/><br/>

CPU가 특정 기억 장소로부터 데이터를 읽고자 할 때 기억장치로 보내주어야 하는 정보는 주소와 읽기 신호이다.
그리고 데이터를 저장하려는 경우에는 해당 기억 장소의 주소와 데이터 및 쓰기 신호를 보내주어야 한다.
따라서 CPU와 기억장치 사이에는 그러한 정보들의 전송 통로인 주소 버스, 데이터 버스 및 제어 신호 선들이 접속되어야 한다.

#### [기억장치 액세스 동작의 시간 흐름도]
<img src="" width="100" height="100"/><br/>

이와 같이 접속된 상태에서 CPU가 기억장치로 데이터를 쓰는 동작의 시간 흐름도(timing diagram)을 보면 그림 1-7(a)와 같다.
CPU는 데이터를 저장할 기억 장소의 주소와 저장할 데이터를 각각 주소 버스와 데이터 버스를 통하여 보내면서 동시에 쓰기 신호를 활성화(activate)시킨다.
이 신호들은 모두 기억장치 쓰기 동작이 완료될 때까지 그대로 유지되어 있어야 한다.
CPU가 주소와 데이터를 보낸 순간부터 저장이 완료될 때까지의 시간을 **기억장치 쓰기 시간**(memory write time)이라고 한다.
> 기억장치 쓰기 시간 (memory write time)
> : CPU가 기억장치로 주소와 데이터를 보낸 순간부터 저장이 완료될 때까지의 시간

CPU가 기억장치로부터 데이터를 읽는 동작의 시간 흐름도는 그림 1-7(b)와 같다.
이 동작을 위하여 CPU는 데이터가 저장되어 있는 기억 장소의 주소를 주소 버스를 통하여 기억장치로 보내면서 동시에 읽기 신호를 활성화시킨다.
그러면 일정 지연 시간이 경과한 후에 기억장치로부터 읽혀진 데이터가 데이터 버스상에 실리며, CPU는 그 데이터를 버스 인터페이스 회로(bus interface circuit)를 통하여 읽어 들이게 된다.
여기서 지연 시간이란 주소를 해독(decode)하는데 걸리는 시간과 기억장치 내부에서 데이터를 인출하는데 걸리는 시간을 합한 시간이다.
CPU가 주소를 발생한 시간부터 읽기 동작이 완료될 때까지의 시간을 **기억장치 읽기 시간**(memory read time)이라고 한다.
> 기억장치 읽기 시간 (memory read time)
> : CPU가 기억장치로 주소를 보낸 순간부터 읽기 동작이 완료될 때까지의 시간

위 그림에서 각 버스의 신호를 중복적으로 표시한 이유는 여러 개의 선들이 0 혹은 1의 값을 가진다는 것을 나타내기 위한 것이다.
<br/>
<br/>
## 2. CPU와 I/O 장치의 접속
I/O 장치에는 외부와의 데이터 입력 및 출력을 위한 각종 주변장치들이 모두 포함된다.
그리고 앞에서 언급한 바와 같이, 보조저장장치들도 CPU가 직접 제어하거나 액세스하지 못하고 I/O 장치들과 마찬가지로 별도의 인터페이스 회로(interface circuit)
혹은 제어기(controller)를 통하기 때문에 I/O 장치들과 같은 방법으로 CPU와 접속되어야 한다. 이 절에서는 I/O 장치 및 보조저장장치를 CPU와 접속하는 기본 원리를 설명하고자 한다.

먼저 다음과 같이 키보드와 프린터가 각각 제어기를 통하여 시스템 버스와 접속되는 경우를 살펴보기로 하자.
#### [CPU와 I/O 장치들 간의 접속]
<img src="" width="100" height="100"/><br/>

CPU가 키보드로부터 데이터를 읽어 들이는 과정은 다음과 같다 :
키보드의 어느 한 키(key)가 눌러지면 그에 대응하는 8-비트(ASCII 코드 7비트+패리티비트) 데이터가 키보드 제어기로 전송되어 **데이터 레지스터**(data register)에 저장되며,
동시에 **상태 레지스터**(status register)의 지정된 비트가 세트된다. 이 비트는 입력 데이터가 준비되었다는 것을 가리키므로, 여기서는 입력 준비(In_RDY) 비트라고 부르기로 한다.
> 데이터 레지스터 (data register)
> : CPU와 I/O 장치간의 임시 데이터 기억장치

> 상태 레지스터 (statuc regiser)
> : I/O 장치의 상태를 나타내는 비트들을 저장하는 레지스터

CPU는 데이터 입력을 원하는 시점에서 먼저 상태 레지스터를 읽어들여서 In_RDY 비트가 1로 세트되어 있는지를 검사한다.
만약 세트되어 있다면, 즉시 데이터 레지스터의 내용을 CPU로 읽어들임으로써 데이터 입력 과정이 완료된다.
그러나 만약 In_RDY 비트가 세트되지 않았다면, CPU는 상태 레지스터의 내용을 읽고 검사하는 동작을 반복하면서 기다린다.
이러한 반복 검사 과정은 In_RDY 비트가 세트될 때까지, 즉 키가 눌러져서 데이터가 들어올 때까지 계속된다. 다음은 지금까지 설명한 과정을 흐름도(flowchart)로 표현한 것이다.
#### [키보드 데이터 입력 과정의 흐름도]
<img src="" width="100" height="100"/><br/>

CPU가 데이터를 프린트 출력하는 과정도 유사하다. CPU는 데이터를 프린터로 보내기 전에 먼저 프린터 제어기 내의 상태 레지스터를 읽어서, 데이터 출력 준비(Out_RDY) 비트를 검사한다.
이것은 프린터가 이전에 받은 데이터에 대한 프린트 동작을 완료하고 다음 프린트 동작을 시작할 준비가 되었는지를 검사하는 절차이다.
Out_DRY 비트가 1로 세트된 것이 확인되면, CPU는 프린트할 데이터를 프린트 제어기의 데이터 레지스터로 쓰고, 프린트 시작 신호를 보낸다.
그러면 제어기는 프린터의 하드웨어를 적절히 구동하여 그 내용을 프린트한다. 이 과정에서도, 만약 Out_DRY 비트가 세트되지 않았다면, CPU는 그 비트에 대한 검사를 반복하면서 기다린다.
여기서 데이터 레지스터는 CPU와 I/O 장치 사이에서 임시 저장소 역할을 하기 때문에 **데이터 버퍼**(data buffer)라고 부르기도 한다.
이 버퍼의 용량을 수십 메가바이트 이상으로 늘려서 프린트할 데이터 파일 전체를 이동시킨다면, 프린트 동작에 대한 CPU의 개입을 줄일 수 있다.
> 데이터 버퍼 (data buffer)
> : CPU와 I/O 장치간의 데이터 임시 기억장치인 데이터 레지스터의 다른 명칭

하드 디스크, SSD(solid-state drive) 및 CD-ROM과 같은 보조저장장치들도 각 장치를 위한 제어기를 통하여 이와 유사한 방법으로 접속된다.
그러나 키보드의 경우에는 데이터가 바이트(8비트) 단위로 전송되지만, 보조저장장치의 경우에는 블록(512바이트, 1024바이트 혹은 4096바이트) 단위로 전송이 이루어지기 때문에,
제어기 내에 적어도 한 블록 이상을 임시 저장할 수 있는 데이터 버퍼가 준비되어야 한다.
디스크 제어기들 중에는 디스크 상의 한 트랙(track)의 내용을 모두 저장할 수 있는 트랙 버퍼 혹은 그 이상의 용량인 디스크 버퍼(disk buffer)를 가지고 있는 경우도 많이 있다.

CPU는 시스템에 접속되어 있는 I/O 장치들을 직접 제어하지는 않지만, 각 장치의 제어기가 수행할 동작을 지정하는 명령(command)을 보내거나 상태 정보와 데이터를 주고받을 수 있어야 한다.
그를 위하여 CPU는 각 I/O 장치의 제어기를 구분하고 정보를 주고받을 수 있어야 한다.
그 방법은 각 제어기 내에 있는 상태 레지스터와 데이터 레지스터를 각각 한 단어 길이의 기억장치로 간주하고, 주소를 한 개씩 배정하는 것이다.
그렇게 되면 CPU는 그 레지스터들을 기억장치와 같은 방법으로 읽기 및 쓰기 동작을 수행할 수 있다.
즉, CPU가 제어기 내부 레지스터들의 주소를 이용하여 해당 I/O 장치를 제어할 수 있게 되는 것이다.
그림 [CPU와 I/O 장치들 간의 접속]()에서 주소 버스와 제어 신호들(I/O 읽기 신호와 I/O 쓰기 신호)이 I/O 제어기들로 연결되는 것도 그 이유 때문이다.
<br/>
<br/>
## 3. 전체 시스템의 구성
이제 지금까지의 설명들을 종합하여 기본적인 구성 요소들을 모두 포함한 완전한 컴퓨터시스템을 구성해보자.
다음은 CPU, 주기억장치 및 I/O 장치들을 시스템 버스를 통해 서로 접속하여 전체 컴퓨터시스템을 구성한 모습을 보여주고 있다.

#### [컴퓨터싯템의 전체 구성도]
<img src="" width="100" height="100"/><br/>

이와 같이 구성된 컴퓨터시스템이 수행할 수 있는 기능들을 주요 요소들과 연관시켜 보면 다음과 같다.
- **프로그램 실행**
    - CPU가 주기억장치로부터 프로그램 코드를 읽어서 실행한다.
- **데이터 저장**
    - 프로그램 실행 결과로서 얻어진 데이터를 주기억장치에 저장한다.
- **데이터 이동**
    - 디스크나 SSD에 저장되어 있는 프로그램과 데이터 블록을 주기억장치로 이동한다.
- **데이터 입력 및 출력**
    - 사용자가 키보드를 통하여 보내는 명령이나 데이터를 읽어 들인다. 또한 CPU가 처리한 결과 값이나 기억장치의 내용을 프린터(혹은 모니터)로 출력한다.
- **제어**
    - 프로그램이 순서대로 실행되도록 혹은 필요에 따라 실행 순서를 변경하도록 조정하며, 각종 제어 신호들을 발생한다.

지금까지는 컴퓨터가 이와 같은 기능들을 수행하기 위해 갖추어야 할 구성요소들과 그들 간의 기본적인 접속 방법에 대하여 설명하였다.
그런데 그와 같이 구성된 컴퓨터는 성능을 높이고 기능을 다양화하기 위하여 계속적인 변화가 이루어져 왔다.
특히 CPU와 주기억장치에 비하여 보조저장장치나 I/O 장치들은 속도가 낮고 전송 방식도 다르기 때문에 직접 시스테메 버스에 접속하는 것이 어려움이 있다.
따라서 그러한 장치들을 위한 확장 버스(expansion bus) 개념이 개발되어 새로운 장치들을 쉽게 시스템에 추가하면서도 시스템 성능을 높일 수 있는 계층적 버스 구조
(hierarchical bus structure)가 채택되고 있다.